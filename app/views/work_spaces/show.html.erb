
<% content_for :subtitle do %>
  Dashboard
<% end %>

<% content_for :content do %>
  <article class="message is-small">
    <div class="message-body">
      * Note: These figures are only for box voters; postal voters are not
      included.
    </div>
  </article>

  <table class="table is-striped is-narrow is-fullwidth">
    <%#
      XXX Might be nice to make head sticky too (as well as each
      CommitteeRoom's info), but this seems tricky with table markup (maybe
      impossible with just CSS?) - see
      https://stackoverflow.com/questions/54689034/pure-css-multiple-stacked-position-sticky.
    %>
    <thead>
      <tr>
        <th>
          Committee Room
          <%= link_to new_work_space_committee_room_path(@work_space, reconfigure: true),
            title: 'Create new committee room' do %>
            <i class="fas fa-plus"></i>
          <% end %>
        </th>
        <th>Polling Station</th>
        <th>
          Labour promises / Registered voters
          <%= link_to work_space_configuration_path(@work_space),
            title: 'Configure workspace figures' do %>
            <i class="fas fa-edit"></i>
          <% end %>
        </th>
        <th>Turnout&nbsp;*</th>
        <th>Turnout percentage&nbsp;*</th>
        <th>Guesstimated Labour votes / Labour votes left&nbsp;*</th>
      </tr>
    </thead>

    <tbody class="is-size-7">
      <% @work_space.latest_observations_by_committee_room.each do |committee_room, observations|
        first_observation = observations.first
        observations.each do |o|
          first_for_committee_room = o == first_observation
          polling_station = o.polling_station
          turnout_observation = o.turnout_observation
        %>

          <tr>
            <% if first_for_committee_room %>
              <%= render 'shared/committee_room_info',
                committee_room: committee_room,
                rowspan: observations.length,
                render_controls: true
              %>
            <% end %>

            <%= render 'polling_station_info',
              polling_station: polling_station,
              turnout_observation: turnout_observation
            %>
          </tr>
        <% end %>
      <% end %>
    </tbody>
  </table>
<% end %>
